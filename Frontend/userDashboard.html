<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Dashboard | SupplyChain Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="css/userDashboard.css">
</head>
<body>
<div class="dashboard">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <h2>Supply<span>Chain</span> Pro</h2>
        </div>
        <div class="nav-menu">
            <a href="#" class="nav-item active" data-section="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a href="pages/shipment.html" class="nav-item" data-section="shipments">
                <i class="fas fa-shipping-fast"></i>
                <span>Shipments</span>
            </a>
            <a href="pages/tracking.html" class="nav-item" data-section="tracking">
                <i class="fas fa-warehouse"></i>
                <span>Order Tracking</span>
            </a>
            <a href="pages/placeOrder.html" class="nav-item" data-section="orders">
                <i class="fas fa-warehouse"></i>
                <span>Orders</span>
            </a>
            <a href="pages/invoice.html" class="nav-item" data-section="invoices">
                <i class="fas fa-file-invoice-dollar"></i>
                <span>Invoices</span>
            </a>
            <a href="pages/order_status_update.html" class="nav-item" data-section="settings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
            <a href="pages/customer_verify.html" class="nav-item" data-section="my profile">
                <i class="fas fa-question-circle"></i>
                <span>Profile</span>
            </a>
        </div>
    </div>
    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <div class="page-title">
                <h1>Customer Dashboard</h1>
            </div>
            <div class="user-profile">
                <div class="notification-bell" id="notificationBell">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                    <div class="notification-panel" id="notificationPanel">
                        <div class="notification-header">
                            Notifications
                        </div>
                        <div class="notification-item unread">
                            <div>Your shipment #SCP-2023-04528 has departed Shanghai</div>
                            <div class="notification-time">2 hours ago</div>
                        </div>
                        <div class="notification-item unread">
                            <div>Invoice #INV-2023-0542 is ready for payment</div>
                            <div class="notification-time">1 day ago</div>
                        </div>
                        <div class="notification-item">
                            <div>New feature: Real-time tracking now available</div>
                            <div class="notification-time">3 days ago</div>
                        </div>
                    </div>
                </div>
                <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="User Profile">
                <span>John Doe</span>
            </div>
        </div>

        <!-- Widgets -->
        <div class="widgets">
            <div class="widget">
                <div class="widget-icon" style="background-color: var(--primary-color);">
                    <i class="fas fa-box-open"></i>
                </div>
                <div class="widget-info">
                    <h3 id="activeShipments">24</h3>
                    <p>Active Shipments</p>
                </div>
            </div>
            <div class="widget">
                <div class="widget-icon" style="background-color: var(--success-color);">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="widget-info">
                    <h3 id="completedShipments">128</h3>
                    <p>Completed Shipments</p>
                </div>
            </div>
            <div class="widget">
                <div class="widget-icon" style="background-color: var(--warning-color);">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="widget-info">
                    <h3 id="delayedShipments">5</h3>
                    <p>Delayed Shipments</p>
                </div>
            </div>
            <div class="widget">
                <div class="widget-icon" style="background-color: var(--accent-color);">
                    <i class="fas fa-times-circle"></i>
                </div>
                <div class="widget-info">
                    <h3 id="cancelledShipments">3</h3>
                    <p>Cancelled Shipments</p>
                </div>
            </div>
        </div>

        <!-- Current Shipment Status -->
        <div class="shipment-status">
            <div class="section-header">
                <h2>Current Shipment Status</h2>
                <a href="#" id="viewAllShipments">View All Shipments</a>
            </div>
            <p id="currentShipmentInfo">Shipment #SCP-2023-04528 - Estimated Delivery: May 15, 2023</p>

            <div class="status-steps">
                <div class="status-step">
                    <div class="step-icon completed">
                        <i class="fas fa-check"></i>
                    </div>
                    <span class="step-label completed">Order Placed</span>
                </div>
                <div class="status-step">
                    <div class="step-icon completed">
                        <i class="fas fa-check"></i>
                    </div>
                    <span class="step-label completed">Processed</span>
                </div>
                <div class="status-step">
                    <div class="step-icon completed">
                        <i class="fas fa-check"></i>
                    </div>
                    <span class="step-label completed">Shipped</span>
                </div>
                <div class="status-step">
                    <div class="step-icon active">
                        <i class="fas fa-truck"></i>
                    </div>
                    <span class="step-label active">In Transit</span>
                </div>
                <div class="status-step">
                    <div class="step-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <span class="step-label">Delivered</span>
                </div>
            </div>

            <div class="shipment-details">
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <div>
                        <strong>Origin:</strong> <span id="shipmentOrigin">Shanghai, China</span>
                    </div>
                    <div>
                        <strong>Destination:</strong> <span id="shipmentDestination">Los Angeles, USA</span>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <div>
                        <strong>Carrier:</strong> <span id="shipmentCarrier">Maersk Line</span>
                    </div>
                    <div>
                        <strong>Vessel:</strong> <span id="shipmentVessel">Maersk Eindhoven</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Shipments -->
        <div class="recent-shipments">
            <div class="section-header">
                <h2>Recent Shipments</h2>
                <a href="#" id="viewAllRecent">View All</a>
            </div>

            <table id="shipmentsTable">
                <thead>
                <tr>
                    <th>Shipment ID</th>
                    <th>Origin</th>
                    <th>Destination</th>
                    <th>Status</th>
                    <th>Estimated Arrival</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr data-shipment-id="SCP-2023-04528">
                    <td>SCP-2023-04528</td>
                    <td>Shanghai, CN</td>
                    <td>Los Angeles, US</td>
                    <td><span class="status-badge status-in-transit">In Transit</span></td>
                    <td>May 15, 2023</td>
                    <td>
                        <button class="action-btn view" onclick="viewShipment('SCP-2023-04528')">View</button>
                        <button class="action-btn cancel" onclick="cancelShipment('SCP-2023-04528')">Cancel</button>
                    </td>
                </tr>
                <tr data-shipment-id="SCP-2023-04521">
                    <td>SCP-2023-04521</td>
                    <td>Hamburg, DE</td>
                    <td>New York, US</td>
                    <td><span class="status-badge status-delivered">Delivered</span></td>
                    <td>May 5, 2023</td>
                    <td>
                        <button class="action-btn view" onclick="viewShipment('SCP-2023-04521')">View</button>
                    </td>
                </tr>
                <tr data-shipment-id="SCP-2023-04515">
                    <td>SCP-2023-04515</td>
                    <td>Singapore, SG</td>
                    <td>Long Beach, US</td>
                    <td><span class="status-badge status-pending">Processing</span></td>
                    <td>May 20, 2023</td>
                    <td>
                        <button class="action-btn view" onclick="viewShipment('SCP-2023-04515')">View</button>
                        <button class="action-btn cancel" onclick="cancelShipment('SCP-2023-04515')">Cancel</button>
                    </td>
                </tr>
                <tr data-shipment-id="SCP-2023-04502">
                    <td>SCP-2023-04502</td>
                    <td>Rotterdam, NL</td>
                    <td>Savannah, US</td>
                    <td><span class="status-badge status-cancelled">Cancelled</span></td>
                    <td>May 1, 2023</td>
                    <td>
                        <button class="action-btn view" onclick="viewShipment('SCP-2023-04502')">View</button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Shipment Detail Modal -->
<div class="modal" id="shipmentModal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <div class="modal-header">
            <h2 id="modalShipmentId">Shipment Details</h2>
        </div>
        <div class="modal-body">
            <div id="modalShipmentContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="action-btn" onclick="closeModal()">Close</button>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal" id="confirmModal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <div class="modal-header">
            <h2 id="confirmModalTitle">Confirm Action</h2>
        </div>
        <div class="modal-body">
            <p id="confirmModalMessage">Are you sure you want to perform this action?</p>
        </div>
        <div class="modal-footer">
            <button class="action-btn cancel" onclick="closeModal()">Cancel</button>
            <button class="action-btn" id="confirmActionBtn">Confirm</button>
        </div>
    </div>
</div>

<script>
    // DOM Elements
    const notificationBell = document.getElementById('notificationBell');
    const notificationPanel = document.getElementById('notificationPanel');
    const navItems = document.querySelectorAll('.nav-item');
    const shipmentModal = document.getElementById('shipmentModal');
    const confirmModal = document.getElementById('confirmModal');
    const viewAllShipments = document.getElementById('viewAllShipments');
    const viewAllRecent = document.getElementById('viewAllRecent');

    // Sample shipment data
    const shipments = {
        'SCP-2023-04528': {
            id: 'SCP-2023-04528',
            origin: 'Shanghai, China',
            destination: 'Los Angeles, USA',
            carrier: 'Maersk Line',
            vessel: 'Maersk Eindhoven',
            status: 'In Transit',
            estimatedArrival: 'May 15, 2023',
            currentLocation: 'Pacific Ocean (25.276987, -157.485356)',
            cargo: 'Electronics (500 cartons)',
            weight: '12,500 kg',
            value: '$250,000',
            notes: 'Temperature controlled cargo. Maintain between 15-25°C.'
        },
        'SCP-2023-04521': {
            id: 'SCP-2023-04521',
            origin: 'Hamburg, Germany',
            destination: 'New York, USA',
            carrier: 'Hapag-Lloyd',
            vessel: 'Montreal Express',
            status: 'Delivered',
            estimatedArrival: 'May 5, 2023',
            actualArrival: 'May 4, 2023',
            cargo: 'Automotive Parts (320 pallets)',
            weight: '8,750 kg',
            value: '$185,000',
            notes: 'Delivered to warehouse B at JFK Airport'
        },
        'SCP-2023-04515': {
            id: 'SCP-2023-04515',
            origin: 'Singapore, Singapore',
            destination: 'Long Beach, USA',
            carrier: 'COSCO',
            vessel: 'COSCO Harmony',
            status: 'Processing',
            estimatedArrival: 'May 20, 2023',
            currentLocation: 'Port of Singapore',
            cargo: 'Textiles (1,200 bales)',
            weight: '15,000 kg',
            value: '$95,000',
            notes: 'Awaiting customs clearance'
        },
        'SCP-2023-04502': {
            id: 'SCP-2023-04502',
            origin: 'Rotterdam, Netherlands',
            destination: 'Savannah, USA',
            carrier: 'MSC',
            vessel: 'MSC Isabella',
            status: 'Cancelled',
            estimatedArrival: 'May 1, 2023',
            cancellationReason: 'Customer request',
            cargo: 'Pharmaceuticals (800 boxes)',
            weight: '3,200 kg',
            value: '$420,000',
            notes: 'Cancelled on April 15, 2023. Refund processed.'
        }
    };

    // Event Listeners
    notificationBell.addEventListener('click', toggleNotifications);
    document.addEventListener('click', closeNotificationsOutside);
    viewAllShipments.addEventListener('click', function(e) {
        e.preventDefault();
        alert('Navigating to all shipments page...');
    });
    viewAllRecent.addEventListener('click', function(e) {
        e.preventDefault();
        alert('Navigating to all recent shipments page...');
    });

    // Navigation
    navItems.forEach(item => {
        item.addEventListener('click', function() {
            navItems.forEach(nav => nav.classList.remove('active'));
            this.classList.add('active');

            const section = this.getAttribute('data-section');
            if (section !== 'dashboard') {
                alert(`Navigating to ${section} section...`);
            }
        });
    });

    // Notification functions
    function toggleNotifications() {
        notificationPanel.style.display = notificationPanel.style.display === 'block' ? 'none' : 'block';
    }

    function closeNotificationsOutside(e) {
        if (!notificationBell.contains(e.target)) {
            notificationPanel.style.display = 'none';
        }
    }

    // Shipment functions
    function viewShipment(shipmentId) {
        const shipment = shipments[shipmentId];
        if (!shipment) return;

        document.getElementById('modalShipmentId').textContent = `Shipment ${shipmentId}`;

        let content = `
                <div class="shipment-detail">
                    <div style="margin-bottom: 15px;">
                        <strong>Status:</strong> <span class="status-badge ${getStatusClass(shipment.status)}">${shipment.status}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <div>
                            <strong>Origin:</strong> ${shipment.origin}
                        </div>
                        <div>
                            <strong>Destination:</strong> ${shipment.destination}
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <div>
                            <strong>Carrier:</strong> ${shipment.carrier}
                        </div>
                        <div>
                            <strong>Vessel:</strong> ${shipment.vessel || 'N/A'}
                        </div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>Estimated Arrival:</strong> ${shipment.estimatedArrival}
                        ${shipment.actualArrival ? `<br><strong>Actual Arrival:</strong> ${shipment.actualArrival}` : ''}
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>Current Location:</strong> ${shipment.currentLocation || 'N/A'}
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>Cargo:</strong> ${shipment.cargo}
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <div>
                            <strong>Weight:</strong> ${shipment.weight}
                        </div>
                        <div>
                            <strong>Value:</strong> ${shipment.value}
                        </div>
                    </div>
                    ${shipment.cancellationReason ? `
                    <div style="margin-bottom: 15px; background-color: #f8d7da; padding: 10px; border-radius: 4px;">
                        <strong>Cancellation Reason:</strong> ${shipment.cancellationReason}
                    </div>
                    ` : ''}
                    <div style="margin-bottom: 15px;">
                        <strong>Notes:</strong> ${shipment.notes}
                    </div>
                </div>
            `;

        document.getElementById('modalShipmentContent').innerHTML = content;
        shipmentModal.style.display = 'flex';
    }

    function cancelShipment(shipmentId) {
        document.getElementById('confirmModalTitle').textContent = 'Cancel Shipment';
        document.getElementById('confirmModalMessage').textContent = `Are you sure you want to cancel shipment ${shipmentId}? This action cannot be undone.`;

        const confirmBtn = document.getElementById('confirmActionBtn');
        confirmBtn.textContent = 'Cancel Shipment';
        confirmBtn.onclick = function() {
            // In a real app, this would call an API
            alert(`Shipment ${shipmentId} cancellation requested.`);
            closeModal();

            // Update the UI
            const row = document.querySelector(`tr[data-shipment-id="${shipmentId}"]`);
            if (row) {
                const statusCell = row.querySelector('td:nth-child(4)');
                statusCell.innerHTML = '<span class="status-badge status-cancelled">Cancelled</span>';

                // Remove cancel button
                const cancelBtn = row.querySelector('.cancel');
                if (cancelBtn) cancelBtn.remove();
            }
        };

        confirmModal.style.display = 'flex';
    }

    function getStatusClass(status) {
        switch(status.toLowerCase()) {
            case 'pending':
            case 'processing':
                return 'status-pending';
            case 'in transit':
                return 'status-in-transit';
            case 'delivered':
                return 'status-delivered';
            case 'cancelled':
                return 'status-cancelled';
            default:
                return '';
        }
    }

    // Modal functions
    function closeModal() {
        shipmentModal.style.display = 'none';
        confirmModal.style.display = 'none';
    }

    // Close modals when clicking outside
    window.addEventListener('click', function(event) {
        if (event.target === shipmentModal) {
            closeModal();
        }
        if (event.target === confirmModal) {
            closeModal();
        }
    });

    // Simulate real-time updates
    function simulateUpdates() {
        // Randomly update the active shipments count
        setInterval(() => {
            const activeElement = document.getElementById('activeShipments');
            let activeCount = parseInt(activeElement.textContent);
            const change = Math.floor(Math.random() * 3) - 1; // -1, 0, or 1
            const newCount = Math.max(0, activeCount + change);
            if (newCount !== activeCount) {
                activeElement.textContent = newCount;
                animateCountChange(activeElement, change);
            }
        }, 10000);

        // Simulate shipment progress
        setTimeout(() => {
            const currentShipmentInfo = document.getElementById('currentShipmentInfo');
            currentShipmentInfo.textContent = 'Shipment #SCP-2023-04528 - Estimated Delivery: May 14, 2023 (Updated)';

            // Update status steps
            setTimeout(() => {
                const steps = document.querySelectorAll('.status-step');
                steps[4].querySelector('.step-icon').classList.add('completed');
                steps[4].querySelector('.step-icon').innerHTML = '<i class="fas fa-check"></i>';
                steps[4].querySelector('.step-label').classList.add('completed');

                // Update status in table
                const row = document.querySelector('tr[data-shipment-id="SCP-2023-04528"]');
                if (row) {
                    const statusCell = row.querySelector('td:nth-child(4)');
                    statusCell.innerHTML = '<span class="status-badge status-delivered">Delivered</span>';

                    // Remove cancel button
                    const cancelBtn = row.querySelector('.cancel');
                    if (cancelBtn) cancelBtn.remove();
                }
            }, 5000);
        }, 8000);
    }

    function animateCountChange(element, change) {
        element.style.transform = change > 0 ? 'scale(1.2)' : 'scale(0.8)';
        element.style.color = change > 0 ? 'green' : 'red';

        setTimeout(() => {
            element.style.transform = 'scale(1)';
            element.style.color = '';
        }, 500);
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        simulateUpdates();
    });

    document.addEventListener('DOMContentLoaded', function() {
        // Get current page URL
        const currentPage = window.location.pathname.split('/').pop() || 'index.html';

        // Remove active class from all nav items
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
        });

        // Add active class to current page nav item
        document.querySelectorAll('.nav-item').forEach(item => {
            const href = item.getAttribute('href');
            if (href && href.includes(currentPage)) {
                item.classList.add('active');
            }
        });

        // Handle navigation clicks
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                // Prevent default if it's already the current page
                const href = this.getAttribute('href');
                if (href && href.includes(currentPage)) {
                    e.preventDefault();
                }
            });
        });
    });
</script>
</body>
</html>