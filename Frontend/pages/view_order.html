<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f9; padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
        th { background-color: #d4e5d4; }
        .update-button { background-color: #4CAF50; color: white; padding: 5px 10px; border: none; cursor: pointer; }
        select { padding: 5px; }
    </style>
</head>
<body>
<h2>Order Management</h2>
<table>
    <thead>
    <tr>
        <th>Order ID</th>
        <th>Customer</th>
        <th>Order Date</th>
        <th>Total Amount</th>
        <th>Status</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody id="order-table"></tbody>
</table>

<script>
    const API_URL = "http://localhost:8082/api/v1/orders";

    async function loadOrders() {
        try {
            const response = await fetch(API_URL);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const orders = await response.json();
            renderOrders(orders);
        } catch (error) {
            console.error("Error loading orders:", error);
            alert("Failed to load orders. Check console for details.");
        }
    }

    function renderOrders(orders) {
        const table = document.getElementById('order-table');
        table.innerHTML = "";

        orders.forEach(order => {
            const row = table.insertRow();

            // Order ID
            row.insertCell(0).textContent = order.id || 'N/A';

            row.insertCell(1).textContent = order.customer?.name || 'N/A';

            // Order Date
            const orderDate = order.orderDate ? new Date(order.orderDate).toLocaleDateString() : 'N/A';
            row.insertCell(2).textContent = orderDate;

            // Total Amount
            row.insertCell(3).textContent = order.totalAmount ? `$${order.totalAmount.toFixed(2)}` : '$0.00';

            // Status (with dropdown)
            const statusCell = row.insertCell(4);
            const statusSelect = document.createElement('select');
            ['PENDING', 'PROCESSING', 'COMPLETED', 'CANCELLED'].forEach(status => {
                const option = document.createElement('option');
                option.value = status;
                option.textContent = status;
                if (order.status === status) option.selected = true;
                statusSelect.appendChild(option);
            });
            statusCell.appendChild(statusSelect);

            // Action button
            const actionCell = row.insertCell(5);
            const updateBtn = document.createElement('button');
            updateBtn.className = 'update-button';
            updateBtn.textContent = 'Update';
            updateBtn.onclick = () => updateOrderStatus(order.id, statusSelect.value);
            actionCell.appendChild(updateBtn);
        });
    }

    async function updateOrderStatus(orderId, newStatus) {
        try {
            const response = await fetch(`${API_URL}/${orderId}/status`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status: newStatus })
            });

            if (!response.ok) throw new Error('Failed to update status');

            alert('Status updated successfully');
            loadOrders(); // Refresh the table
        } catch (error) {
            console.error('Error updating status:', error);
            alert('Failed to update status');
        }
    }

    // Load orders when page loads
    document.addEventListener('DOMContentLoaded', loadOrders);
</script>
</body>
</html>
